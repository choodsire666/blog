**笔记来源：**[**黑马程序员Redis入门到实战教程，深度透析redis底层原理+redis分布式锁+企业解决方案**](https://www.bilibili.com/video/BV1cr4y1671t/?spm_id_from=333.337.search-card.all.click&vd_source=e8046ccbdc793e09a75eb61fe8e84a30)
Nginx编程需要用到Lua语言，因此我们必须先入门Lua的基本语法。
## 1 初识Lua
Lua 是一种轻量小巧的脚本语言，用标准C语言编写并以源代码形式开放， 其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。官网：[https://www.lua.org/](https://www.lua.org/)
![](https://cdn.nlark.com/yuque/0/2022/png/22334924/1665042309102-5b02d70e-becd-4955-9c24-91c8367e8c80.png#averageHue=%23f9f9f9&clientId=ud93c4645-373a-4&id=R3Kas&originHeight=387&originWidth=1123&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u8268b769-550a-404d-a8a6-67024e71e51&title=)
Lua经常嵌入到C语言开发的程序中，例如游戏开发、游戏插件等。
Nginx本身也是C语言开发，因此也允许基于Lua做拓展。
## 2 HelloWorld
CentOS7默认已经安装了Lua语言环境，所以可以直接运行Lua代码。
1）在Linux虚拟机的任意目录下，新建一个hello.lua文件
![](https://cdn.nlark.com/yuque/0/2022/png/22334924/1665042308292-b4cdccf9-2499-44f5-891f-eff7ef170d57.png#averageHue=%23b6d6ad&clientId=ud93c4645-373a-4&id=e5otD&originHeight=98&originWidth=683&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u87391342-e6b5-4bfd-8d03-0b1675f4fcc&title=)
2）添加下面的内容
```lua
print("Hello World!")
```
3）运行
![](https://cdn.nlark.com/yuque/0/2022/png/22334924/1665042308290-f13f3d14-614f-4867-ae6e-d326746eaa74.png#averageHue=%23a5c7a6&clientId=ud93c4645-373a-4&id=b1TAQ&originHeight=100&originWidth=678&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=uba31e35c-fc36-4a81-afda-b33db9ccfc6&title=)
## 3 变量和循环
学习任何语言必然离不开变量，而变量的声明必须先知道数据的类型。
### 3.1 Lua的数据类型
Lua中支持的常见数据类型包括：
![](https://cdn.nlark.com/yuque/0/2022/png/22334924/1665042308491-5990029e-73c4-4611-8b43-a7758630e354.png#averageHue=%23f0eeea&clientId=ud93c4645-373a-4&id=dJHIJ&originHeight=471&originWidth=1509&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ubff9bc52-f396-4c68-974e-4fa68f185b6&title=)
另外，Lua提供了type()函数来判断一个变量的数据类型：
![](https://cdn.nlark.com/yuque/0/2022/png/22334924/1665042308337-2037f6f2-4cf2-4131-a884-9fa032c57bc6.png#averageHue=%23cefafa&clientId=ud93c4645-373a-4&id=uWHyy&originHeight=166&originWidth=596&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u7381398d-f121-425f-8fe7-e1b6ac98bf7&title=) 
### 3.2 声明变量
Lua声明变量的时候无需指定数据类型，而是用local来声明变量为局部变量：
```lua
-- 声明字符串，可以用单引号或双引号，
local str = 'hello'
-- 字符串拼接可以使用 ..
local str2 = 'hello' .. 'world'
-- 声明数字
local num = 21
-- 声明布尔类型
local flag = true
```
Lua中的table类型既可以作为数组，又可以作为Java中的map来使用。数组就是特殊的table，key是数组角标而已：
```lua
-- 声明数组 ，key为角标的 table
local arr = {'java', 'python', 'lua'}
-- 声明table，类似java的map
local map =  {name='Jack', age=21}
```

Lua中的数组角标是从1开始，访问的时候与Java中类似：
```lua
-- 访问数组，lua数组的角标从1开始
print(arr[1])
```

Lua中的table可以用key来访问：
```lua
-- 访问table
print(map['name'])
print(map.name)
```
### 3.3 循环
对于table，我们可以利用for循环来遍历。不过数组和普通table遍历略有差异。
遍历数组：
```lua
-- 声明数组 key为索引的 table
local arr = {'java', 'python', 'lua'}
-- 遍历数组
for index,value in ipairs(arr) do
    print(index, value) 
end
```

遍历普通table
```lua
-- 声明map，也就是table
local map = {name='Jack', age=21}
-- 遍历table
for key,value in pairs(map) do
   print(key, value) 
end
```
## 4 条件控制、函数
Lua中的条件控制和函数声明与Java类似。
### 4.1 函数
定义函数的语法：
```lua
function 函数名( argument1, argument2..., argumentn)
    -- 函数体
    return 返回值
end
```

例如，定义一个函数，用来打印数组：
```lua
function printArr(arr)
    for index, value in ipairs(arr) do
        print(value)
    end
end
```

### 4.2 条件控制
类似Java的条件控制，例如if、else语法：
```lua
if(布尔表达式)
then
   --[ 布尔表达式为 true 时执行该语句块 --]
else
   --[ 布尔表达式为 false 时执行该语句块 --]
end
```
与java不同，布尔表达式中的逻辑运算是基于英文单词：
![](https://cdn.nlark.com/yuque/0/2022/png/22334924/1665042308741-2d93f6fe-5dc1-4ba8-8342-8652274c274f.png#averageHue=%23cfcfce&clientId=ud93c4645-373a-4&id=NVLeo&originHeight=317&originWidth=1481&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u905bd270-0462-43d0-835e-3ad6ae51472&title=)
### 4.3 案例
需求：自定义一个函数，可以打印table，当参数为nil时，打印错误信息
```lua
function printArr(arr)
    if not arr then
        print('数组不能为空！')
    end
    for index, value in ipairs(arr) do
        print(value)
    end
end
```

