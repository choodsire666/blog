---
title: 2.SpringCloud工程部署启动
urlname: gc7ulkvzqyg3l0f1
date: '2024-03-28 16:23:27'
updated: '2024-03-28 16:23:50'
description: "1.工程搭建部署方案一：完整工程导入\U0001F4CEcloud.zip，如无法运行尝试换未编译版：\U0001F4CEcloud-demo.zip下载解压上述工程，ide工具导入方案二：从零开始搭建1.工程与module创建1.1 父工程创建1.2 子module创建module名称：order-service、user..."
cover: ''
---
# 1.工程搭建部署
## 方案一：完整工程导入

- [cloud.zip](https://www.yuque.com/attachments/yuque/0/2024/zip/29688613/1711614209686-289d8476-8eec-4f07-bded-84ccb04f87e3.zip?_lake_card=%7B%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2024%2Fzip%2F29688613%2F1711614209686-289d8476-8eec-4f07-bded-84ccb04f87e3.zip%22%2C%22name%22%3A%22cloud.zip%22%2C%22size%22%3A29110%2C%22ext%22%3A%22zip%22%2C%22source%22%3A%22%22%2C%22status%22%3A%22done%22%2C%22download%22%3Atrue%2C%22taskId%22%3A%22u23f29cca-eba0-411a-bd9a-159e4638ba9%22%2C%22taskType%22%3A%22transfer%22%2C%22type%22%3A%22application%2Fzip%22%2C%22mode%22%3A%22title%22%2C%22id%22%3A%22u4d8a247e%22%2C%22card%22%3A%22file%22%7D)，如无法运行尝试换未编译版：[cloud-demo.zip](https://www.yuque.com/attachments/yuque/0/2024/zip/29688613/1711614209692-eba9d49a-83d7-4b5c-aa1d-60838726fb65.zip?_lake_card=%7B%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2024%2Fzip%2F29688613%2F1711614209692-eba9d49a-83d7-4b5c-aa1d-60838726fb65.zip%22%2C%22name%22%3A%22cloud-demo.zip%22%2C%22size%22%3A13967%2C%22ext%22%3A%22zip%22%2C%22source%22%3A%22%22%2C%22status%22%3A%22done%22%2C%22download%22%3Atrue%2C%22taskId%22%3A%22u11a575a6-0e1a-44bc-8cd0-c6fe967b134%22%2C%22taskType%22%3A%22transfer%22%2C%22type%22%3A%22application%2Fzip%22%2C%22mode%22%3A%22title%22%2C%22id%22%3A%22u98d77f21%22%2C%22card%22%3A%22file%22%7D)
- 下载解压上述工程，ide工具导入
## 方案二：从零开始搭建
### 1.工程与module创建
#### 1.1 父工程创建
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671679628333-a3a42ccd-98f9-4c95-b28a-264eb671610f.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_26%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%23373b3c&clientId=uc3a708f6-c54b-4&from=paste&height=403&id=ua637f484&originHeight=786&originWidth=914&originalType=binary&ratio=1&rotation=0&showTitle=false&size=123629&status=done&style=none&taskId=ue20731f8-f0cc-40c0-ab8d-5c7ff7fe256&title=&width=469)
#### 1.2 子module创建

- module名称：order-service、user-service
- 无效文件夹删除，整体结构如图2
## ![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671679668128-360b9b13-6b91-49f6-8857-9eedcec3e496.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_20%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%233d444e&clientId=uc3a708f6-c54b-4&from=paste&height=108&id=ub71f562f&originHeight=231&originWidth=695&originalType=binary&ratio=1&rotation=0&showTitle=false&size=63557&status=done&style=none&taskId=udb743363-4cae-4091-99d1-872d15458e0&title=&width=325)![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671679767233-a7081d90-b3dd-4205-b278-5a320b5a7599.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_14%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%233e4754&clientId=uc3a708f6-c54b-4&from=paste&height=108&id=ufe48f2af&originHeight=172&originWidth=507&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20511&status=done&style=none&taskId=u9e4f6dfe-7269-45cf-9b38-27b7f472cd5&title=&width=318.5)
#### 1.3 父pom资源引入
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671691054672-3614b142-9da6-49df-a237-f8c17bad8c14.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_35%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%2388744a&clientId=u57a44f33-7e36-4&from=paste&height=615&id=u7a9ece5c&originHeight=1230&originWidth=1240&originalType=binary&ratio=1&rotation=0&showTitle=false&size=272374&status=done&style=none&taskId=u2b0502a0-5fbc-47a9-813f-8889cfe59a4&title=&width=620)
粘贴以下资源依赖，粘贴后maven会自动拉取依赖，如未拉取请手动刷新
```xml
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.3.9.RELEASE</version>
    <relativePath/>
</parent>

<properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
    <java.version>1.8</java.version>
    <spring-cloud.version>Hoxton.SR10</spring-cloud.version>
    <mysql.version>5.1.47</mysql.version>
    <mybatis.version>2.1.1</mybatis.version>
    <lombok.version>1.18.20</lombok.version>
</properties>

<dependencyManagement>
    <dependencies>
        <!-- springCloud -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-dependencies</artifactId>
            <version>${spring-cloud.version}</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        <!-- mysql驱动 -->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>${mysql.version}</version>
        </dependency>
        <!--mybatis-->
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>${mybatis.version}</version>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <version>${lombok.version}</version>
        </dependency>
    </dependencies>
</dependencyManagement>
```
#### 1.4 子module资源引入
##### user-service
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671691097793-b56c205d-c7e4-4f45-9402-8d7b29a10256.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_38%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%23756a49&clientId=u57a44f33-7e36-4&from=paste&id=u0a3940b3&originHeight=1020&originWidth=1321&originalType=binary&ratio=1&rotation=0&showTitle=false&size=231770&status=done&style=none&taskId=u24440ecb-9e54-4e9a-ab59-01bb64f2bd3&title=)
```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
    </dependency>
    <!--mybatis-->
    <dependency>
        <groupId>org.mybatis.spring.boot</groupId>
        <artifactId>mybatis-spring-boot-starter</artifactId>
    </dependency>
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
    </dependency>
</dependencies>
<build>
    <finalName>app</finalName>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
        </plugin>
    </plugins>
</build>
```
##### order-service
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671691150294-04259330-36e5-4736-a911-ec460caba6c0.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_39%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%237c6f4b&clientId=u57a44f33-7e36-4&from=paste&id=ud9b51f00&originHeight=1078&originWidth=1377&originalType=binary&ratio=1&rotation=0&showTitle=false&size=247780&status=done&style=none&taskId=ufd17053e-2069-4ac7-9f65-a9d844edfa6&title=)
```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
    </dependency>
    <!--mybatis-->
    <dependency>
        <groupId>org.mybatis.spring.boot</groupId>
        <artifactId>mybatis-spring-boot-starter</artifactId>
    </dependency>
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
    </dependency>
</dependencies>
<build>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
        </plugin>
    </plugins>
</build>
```
#### 1.5 业务代码编写
###### 1.user-service
application.yml配置文件
```yaml
server:
  port: 8081
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/cloud_user?useSSL=false
    username: root
    password: root123456
    driver-class-name: com.mysql.jdbc.Driver
mybatis:
  type-aliases-package: cn.itcast.user.pojo
  configuration:
    map-underscore-to-camel-case: true
logging:
  level:
    cn.itcast: debug
  pattern:
    dateformat: MM-dd HH:mm:ss:SSS
```
|--mapper
|-- UserMapper 
```java
package cn.itcast.user.mapper;

import cn.itcast.user.pojo.User;
import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.Select;

/**
 * 用户持久层
 *
 * @author 
 * @date 2022-12-22 14:12
 */
public interface UserMapper {

    /**
     * 根据ID查找用户
     * @param id    用户ID
     * @return      用户实体信息
     */
    @Select("select * from tb_user where id=#{id}")
    User findById(@Param("id") Long id);
}
```
|--pojo
|-- User 
```java
package cn.itcast.user.pojo;

import lombok.Data;

/**
 * 用户实体
 *
 * @author 
 * @date 2022-12-22 14:07
 */
@Data
public class User {

    /**
     * 主键ID
     */
    private Long id;

    /**
     * 用户姓名
     */
    private String username;

    /**
     * 用户地址
     */
    private String address;
}
```
|--service
|-- UserService 
```java
package cn.itcast.user.service;

import cn.itcast.user.mapper.UserMapper;
import cn.itcast.user.pojo.User;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.Objects;

/**
 * 用户业务层
 *
 * @author 
 * @date 2022-12-22 14:13
 */
@Service
public class UserService {

    @Autowired
    private UserMapper userMapper;

    /**
     * 根据ID查找用户
     * @param id    用户ID
     * @return      用户实体信息
     */
    public User findById(Long id) {
        if (Objects.isNull(id)) {
            return null;
        }
        return userMapper.findById(id);
    }

}
```
|--web
|-- UserController 
```java
package cn.itcast.user.web;

import cn.itcast.user.pojo.User;
import cn.itcast.user.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * 用户控制层
 *
 * @author 
 * @date 2022-12-22 14:15
 */
@RestController
@RequestMapping("/user")
public class UserController {

    @Autowired
    private UserService userService;

    /**
     * 根据ID查找用户
     * @param id    ID
     * @return      用户信息
     */
    @GetMapping("/{id}")
    public User findById(@PathVariable("id") Long id) {
        return userService.findById(id);
    }
}
```
|--UserApplication
```java
package cn.itcast.user;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

/**
 * 启动类
 *
 * @author 
 * @date 2022-12-22 14:00
 */
@MapperScan("cn.itcast.user.mapper")
@SpringBootApplication
public class UserApplication {

    public static void main(String[] args) {
        SpringApplication.run(UserApplication.class, args);
        System.out.println("用户工程启动成功");
    }
}

```
###### 2.order-service
application.yml配置文件
```yaml
server:
  port: 8080
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/cloud_order?useSSL=false
    username: root
    password: root123456
    driver-class-name: com.mysql.jdbc.Driver
mybatis:
  type-aliases-package: cn.itcast.order.pojo
  configuration:
    map-underscore-to-camel-case: true
logging:
  level:
    cn.itcast: debug
  pattern:
    dateformat: MM-dd HH:mm:ss:SSS
```
|--mapper
|-- OrderMapper 
```java
package cn.itcast.order.mapper;

import cn.itcast.order.pojo.Order;
import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.Select;

/**
 * 订单持久层
 *
 * @author 
 * @date 2022-12-22 14:22
 */
public interface OrderMapper {

    /**
     * 根据ID查找订单
     * @param id    订单ID
     * @return      订单对象
     */
    @Select("select * from tb_order where id=#{id}")
    Order findById(@Param("id")Long id);
}

```
|--pojo
|-- Order 
```java
package cn.itcast.order.pojo;

import lombok.Data;

/**
 * 订单实体(vo并非dto)
 *
 * @author 
 * @date 2022-12-22 14:19
 */
@Data
public class Order {

    /**
     * 主键ID
     */
    private Long id;

    /**
     * 用户主键ID
     */
    private Long userId;

    /**
     * 商品名称
     */
    private String name;

    /**
     * 商品价格
     */
    private Long price;

    /**
     * 商品数量
     */
    private Integer num;

    /**
     * 用户信息
     */
    private User user;
}

```
|-- User 
```java
package cn.itcast.order.pojo;

import lombok.Data;

/**
 * 用户实体
 *
 * @author 
 * @date 2022-12-22 14:07
 */
@Data
public class User {

    /**
     * 主键ID
     */
    private Long id;

    /**
     * 用户姓名
     */
    private String username;

    /**
     * 用户地址
     */
    private String address;
}

```
|--service
|-- OrderService 
```java
package cn.itcast.order.service;

import cn.itcast.order.mapper.OrderMapper;
import cn.itcast.order.pojo.Order;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

/**
 * 订单业务层
 *
 * @author 
 * @date 2022-12-22 14:24
 */
@Service
public class OrderService {

    @Autowired
    private OrderMapper orderMapper;

    /**
     * 根据ID查找订单
     * @param id    订单ID
     * @return      订单对象
     */
    public Order findById(Long id) {
        Order order = orderMapper.findById(id);
        return order;
    }
}

```
|--web
|-- OrderController 
```java
package cn.itcast.order.web;

import cn.itcast.order.pojo.Order;
import cn.itcast.order.service.OrderService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * 订单控制层
 *
 * @author 
 * @date 2022-12-22 14:25
 */
@RestController
@RequestMapping("/order")
public class OrderController {

    @Autowired
    private OrderService orderService;

    /**
     * 根据ID查找订单
     * @param orderId    订单ID
     * @return           订单对象
     */
    @GetMapping("/{orderId}")
    public Order findById(@PathVariable("orderId")Long orderId) {
        return orderService.findById(orderId);
    }
}

```
|--OrderApplication
```java
package cn.itcast.order;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

/**
 * 启动类
 *
 * @author 
 * @date 2022-12-22 14:05
 */
@MapperScan("cn.itcast.order.mapper")
@SpringBootApplication
public class OrderApplication {

    public static void main(String[] args) {
        SpringApplication.run(OrderApplication.class, args);
        System.out.println("订单工程启动成功");

    }
}

```
# 2.数据库导入
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671681237854-a2fee76b-5b60-4a3f-80d5-371aadd2ce48.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_50%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%23efb64a&clientId=uc3a708f6-c54b-4&from=paste&height=767&id=u457cbdeb&originHeight=767&originWidth=1745&originalType=binary&ratio=1&rotation=0&showTitle=false&size=158639&status=done&style=none&taskId=u068c0b4e-f768-4e28-939b-42a198c5091&title=&width=1745)

- 需参见上图新建两个数据库，然后导入DDL语句
- [cloud-order.sql](https://www.yuque.com/attachments/yuque/0/2024/sql/29688613/1711614209692-fae94b4f-bd86-43c3-b57f-971fe7bc146b.sql?_lake_card=%7B%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2024%2Fsql%2F29688613%2F1711614209692-fae94b4f-bd86-43c3-b57f-971fe7bc146b.sql%22%2C%22name%22%3A%22cloud-order.sql%22%2C%22size%22%3A1909%2C%22ext%22%3A%22sql%22%2C%22source%22%3A%22%22%2C%22status%22%3A%22done%22%2C%22download%22%3Atrue%2C%22taskId%22%3A%22ub1c8441c-fb76-4fdc-9acb-ef5003af146%22%2C%22taskType%22%3A%22transfer%22%2C%22type%22%3A%22%22%2C%22mode%22%3A%22title%22%2C%22id%22%3A%22u6163f391%22%2C%22card%22%3A%22file%22%7D)
- [cloud-user.sql](https://www.yuque.com/attachments/yuque/0/2024/sql/29688613/1711614209758-078ca2da-e2f2-4722-b79f-1b6ddfbbfc56.sql?_lake_card=%7B%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2024%2Fsql%2F29688613%2F1711614209758-078ca2da-e2f2-4722-b79f-1b6ddfbbfc56.sql%22%2C%22name%22%3A%22cloud-user.sql%22%2C%22size%22%3A1542%2C%22ext%22%3A%22sql%22%2C%22source%22%3A%22%22%2C%22status%22%3A%22done%22%2C%22download%22%3Atrue%2C%22taskId%22%3A%22uf705b222-b854-4e0b-898e-1a697e345a0%22%2C%22taskType%22%3A%22transfer%22%2C%22type%22%3A%22%22%2C%22mode%22%3A%22title%22%2C%22id%22%3A%22u77da0722%22%2C%22card%22%3A%22file%22%7D)

导完如下
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671681356590-62741dc3-719e-42cb-a8d0-5a1f454c4ccd.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_10%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%23e5d1e5&clientId=uc3a708f6-c54b-4&from=paste&height=467&id=u1f9be48d&originHeight=467&originWidth=366&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34176&status=done&style=none&taskId=uc3415a9c-c9f8-48d5-9b4c-d42a8b5fab9&title=&width=366)
# 3.项目启动
## 3.1 启动并访问user-service
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671691676225-a66b5615-1051-4553-b1fe-092375281f89.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_30%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%23f4f4f5&clientId=u57a44f33-7e36-4&from=paste&height=97&id=ubf02378f&originHeight=194&originWidth=1066&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29158&status=done&style=none&taskId=ufd7866d9-af88-4f4f-bc37-815f7159b92&title=&width=533)
## 3.2 启动并访问order-service
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671691689268-ae891799-358d-4c2f-b8be-af9b118a5d39.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_42%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%23f4f4f5&clientId=u57a44f33-7e36-4&from=paste&height=99&id=u3e1bc5a2&originHeight=198&originWidth=1476&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34745&status=done&style=none&taskId=ua676ebbc-e587-4a2f-995c-89fb1d26e2a&title=&width=738)
观察发现，虽然order-service服务调用成功，但是里面的user对象却是空的。原因我们应该也可以了解到是因为User对象数据数存储在数据库：tb_user，而此工程连接数据库是：tb_order，查询此数据库时无法获取对应的User数据，怎么获取？获取的具体实现我们将在下一章节进一步铺开。
# 4.服务远程调用
分析现有链路调用关系可以发现：

- [http://localhost:8081/user/{id}](http://localhost:8081/user/1) 可以获取用户信息
- [http://localhost:8081/order/{orderId}](http://localhost:8081/user/1) 可以获取订单信息，但是用户信息为空

想要订单信息中返回用户信息，只要在获取订单链路中追加对用户信息的获取、返回值的组装即可，由此引申出微服务之间的远程服务调用，具体调整可见下图。
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671693628584-f9d61e3f-a4fc-4c75-8653-f983ec8ca3f3.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_39%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%23fbfafa&clientId=ue26b4ec1-da04-4&from=paste&height=586&id=ud30211e1&originHeight=586&originWidth=1385&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55377&status=done&style=none&taskId=uac9ee01c-214b-4ba8-b336-015f932db5a&title=&width=1385)
## 时序图说明
上述图形为时序图，一般用来描述系统与系统之间的交互流程，主要是交互API、代码顺序、参数一般忽略，时序图不同于业务流程，更关注业务实现过程中系统前后依赖，数据请求与返回，以下为笔者实际工作场景示例：
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671693775778-da140333-b70e-4523-897a-39b392710424.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_38%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%23f4f7f8&clientId=ue26b4ec1-da04-4&from=paste&height=1532&id=quJur&originHeight=1532&originWidth=1328&originalType=binary&ratio=1&rotation=0&showTitle=false&size=401177&status=done&style=none&taskId=ue656247c-3977-46af-aad5-d6c6d4d74e1&title=&width=1328)

## 服务远程调用实现
### 注入RestTemplate
> 此处推荐一个小的优雅工具：[https://carbon.now.sh/](https://carbon.now.sh/)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671694981210-c2c63a77-c568-4d30-92db-c82c34f56fcb.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_21%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%233b4145&clientId=ue26b4ec1-da04-4&from=paste&height=704&id=u359eb056&originHeight=704&originWidth=720&originalType=binary&ratio=1&rotation=0&showTitle=false&size=167095&status=done&style=none&taskId=u3c687119-b897-4add-b170-af764015adc&title=&width=720)
### RestTemplate完成远程服务调用
> 在此笔者除了完成远程服务调用，同时对代码做了结构化、异常校验、函数封装。虽然此处逻辑并不复杂，但是对于主干逻辑简化和代码风格，希望能起到一个引导作用。

```java
package cn.itcast.order.service;

import cn.itcast.order.mapper.OrderMapper;
import cn.itcast.order.pojo.Order;
import cn.itcast.order.pojo.User;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

import java.util.Objects;

/**
* 订单业务层
*
* @author 
* @date 2022-12-22 14:24
*/
@Service
public class OrderService {

    @Autowired
    private OrderMapper orderMapper;

    @Autowired
    private RestTemplate restTemplate;

    /**
	 * 根据ID查找订单
     * @param id    订单ID
     * @return      订单对象
     */
    public Order findById(Long id) {

        // step 1 : 查询订单原始数据
        Order order = orderMapper.findById(id);
        if (Objects.isNull(order)) {
            return null;
        }

        // step 2 : 查询用户数据
        User user = queryUserInfoById(order.getUserId());

        // step 3 : 组装用户数据
        if (Objects.nonNull(user)) {
            order.setUser(user);
        }

        // step 4: 数据返回
        return order;
    }

    /**
	 * 根据用户ID查找用户信息
	 * @param userId    用户ID
	 * @return          用户信息
	 */
    private User queryUserInfoById(Long userId) {
        String url = "http://localhost:8081/user/" + userId;
        return restTemplate.getForObject(url, User.class);
    }
}
```
### 重启并访问order-service
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671695330767-b70f547d-a52b-472c-ba25-fc6d11fcef16.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_31%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%23f9f6f5&clientId=ue26b4ec1-da04-4&from=paste&height=129&id=u1f43615c&originHeight=129&originWidth=1098&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21071&status=done&style=none&taskId=u87ae8605-0a4a-41b1-b34a-4ac03655353&title=&width=1098)
### RestTemplate如何实现远程服务调用
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1169676/1671696192093-3402b29a-a0ae-4ffe-802a-98c63671171a.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_52%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%23faf9f9&clientId=ue26b4ec1-da04-4&from=paste&height=877&id=u789c2499&originHeight=877&originWidth=1819&originalType=binary&ratio=1&rotation=0&showTitle=false&size=174079&status=done&style=none&taskId=u7bb73761-472a-408c-9ea3-d6738dcef0e&title=&width=1819)
# 5.总结
本节笔者带领大家完成了SpringCloud工程从0->1的搭建，当然你不想搭建也可以直接采用方案一，二者等效，至此读者们完成了一个微服务工程的搭建、部署、访问。同时在本节最后一章，笔者基于RestTemplate发起的http请求实现远程调用，实现当A系统想要获取B系统数据时的跨系统数据交互。然而RESTful API(进一步了解可移步：[链接](https://www.yuque.com/xiankanpengyouquandisitiaodongtai/diods0/qb0zidhvxn65z432))访问并不是微服务的唯一解决方案，如Dubbo的交互一样可以实现，希望读者们能不限于此。
在本章节，笔者希望大家对于微服务的拆分，服务调用关系有个初步认知，本例中当order-service调用user-service时，前者就充当了服务调用方，后者则是服务提供方，这种调用关系在后续我们将会大量使用。

---

**思考问题**

- 如何实现服务远程调用？
- 服务远程调用解决了什么问题？
- 还有哪些技术可以实现远程服务调用？

---

# 6.推荐阅读资料

- 了解时序图绘制：[https://www.cnblogs.com/liuyitan/p/16631240.html](https://www.cnblogs.com/liuyitan/p/16631240.html)
